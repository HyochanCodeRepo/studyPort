<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 스터디 관리 | StudyMate</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/create.css">
</head>
<body>
<!-- Animated Background -->
<div class="bg-animation">
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
</div>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <a href="/" class="logo">
            <img src="/images/StudyUsLogo.png" alt="StudyUs" class="logo-img">
        </a>

        <div class="search-bar">
            <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
            </svg>
            <input type="text" class="search-input" placeholder="관심있는 스터디를 검색해보세요...">
        </div>

        <nav class="nav-links">
            <div th:if="${isLoggedIn}" class="user-info">
                <div class="user-dropdown">
                    <span class="welcome-message" onclick="toggleDropdown()">
                        <span th:text="${userName != null ? userName : email}">사용자명</span>님 환영합니다!
                        <svg class="dropdown-arrow" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path>
                        </svg>
                    </span>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="/members/profile" class="dropdown-item">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path>
                            </svg>
                            내정보 변경
                        </a>
                        <a href="/study/manage" class="dropdown-item">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                            내 스터디 관리
                        </a>
                        <hr class="dropdown-divider">
                        <a href="/members/logout" class="dropdown-item logout">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"></path>
                            </svg>
                            로그아웃
                        </a>
                    </div>
                </div>
            </div>
            <div th:unless="${isLoggedIn}" class="auth-links">
                <a href="/members/login" class="nav-btn login-btn">로그인</a>
                <a href="/members/signup" class="nav-btn signup-btn">회원가입</a>
            </div>
        </nav>
    </div>
</header>

<!-- Main Content -->
<div class="main-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <h3 class="sidebar-title">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                </svg>
                스터디 관리
            </div>
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <svg class="toggle-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </h3>

        <ul class="category-list">
            <li class="category-item">
                <a href="/members/profile" class="category-link">
                    <span class="category-icon">👤</span>
                    내정보 변경
                </a>
            </li>
            <li class="category-item">
                <a href="/study/manage" class="category-link active">
                    <span class="category-icon">📚</span>
                    스터디 관리
                </a>
            </li>
            <li class="category-item">
                <a href="/study/approval-requests" class="category-link">
                    <span class="category-icon">✅</span>
                    스터디 승인 관리
                    <span th:if="${pendingRequestsCount != null && pendingRequestsCount > 0}" 
                          class="notification-badge" 
                          th:text="${pendingRequestsCount}">0</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Study Management Content -->
    <main class="create-container fade-in">
        <h2 class="create-title">내 스터디 관리</h2>
        <p class="create-subtitle">스터디 운영 현황을 확인하고 관리하세요</p>

        <div class="manage-container">
            <!-- 내가 관리하는 스터디 섹션 -->
            <div class="section-divider">
                <div class="section-title">내가 관리하는 스터디 (스터디장)</div>
            </div>

            <div th:if="${#lists.isEmpty(managedStudies)}" class="empty-state">
                <svg width="64" height="64" fill="currentColor" viewBox="0 0 20 20" style="opacity: 0.5; margin-bottom: 1rem;">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                </svg>
                <h3 style="margin-bottom: 1rem; color: #374151;">관리하고 있는 스터디가 없습니다</h3>
                <p style="margin-bottom: 2rem; color: #6b7280;">새로운 스터디를 만들어 멤버들과 함께 성장해보세요!</p>
                <a href="/study/create" class="create-study-btn">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                    </svg>
                    새 스터디 만들기
                </a>
            </div>

            <div th:unless="${#lists.isEmpty(managedStudies)}" class="managed-studies">
                <div class="study-stats">
                    <div class="stat-item">
                        <span class="stat-number" th:text="${#lists.size(managedStudies)}">0</span>
                        <span class="stat-label">관리 중인 스터디</span>
                    </div>
                </div>

                <div class="study-grid">
                    <div th:each="study : ${managedStudies}" class="study-manage-card">
                        <div class="study-header">
                            <div class="study-category" th:text="${study.topic}">카테고리</div>
                            <div class="study-status">
                                <svg class="status-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                운영 중
                            </div>
                        </div>
                        <h3 class="study-title" th:text="${study.name}">스터디 제목</h3>
                        <p class="study-description" th:text="${study.description}">스터디 설명</p>
                        
                        <div class="study-meta">
                            <div class="meta-item">
                                <svg class="meta-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                                </svg>
                                <span th:text="${study.capacity + '명 모집'}">인원</span>
                            </div>
                            <div class="meta-item">
                                <svg class="meta-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                </svg>
                                <span th:text="${study.location ?: '지역 미설정'}">지역</span>
                            </div>
                        </div>

                        <div class="study-actions">
                            <a th:href="@{/study/admin/read/{id}(id=${study.id})}" class="action-btn view-btn">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                </svg>
                                관리자 상세보기
                            </a>
                            <button type="button" class="action-btn edit-btn" onclick="editStudy('${study.id}')">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                                </svg>
                                수정하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 내가 소속된 스터디 섹션 -->
            <hr class="section-divider-line">
            
            <div class="section-divider">
                <div class="section-title">내가 소속된 스터디 (멤버)</div>
            </div>

            <div class="joined-studies">
                <div class="empty-state">
                    <svg width="64" height="64" fill="currentColor" viewBox="0 0 20 20" style="opacity: 0.5; margin-bottom: 1rem;">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                    </svg>
                    <h3 style="margin-bottom: 1rem; color: #374151;">참여 중인 스터디가 없습니다</h3>
                    <p style="margin-bottom: 2rem; color: #6b7280;">스터디 참여 기능은 준비 중입니다!</p>
                    <div class="placeholder-space" style="height: 100px; background: rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #666; font-style: italic;">
                        스터디 가입 기능 구현 예정 공간
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Sidebar Toggle Button (for collapsed state) -->
<button class="sidebar-toggle-btn" onclick="toggleSidebar()">
    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
    </svg>
</button>

<style>
.manage-container {
    max-width: 1000px;
    margin: 0 auto;
}

.section-divider {
    margin: 2rem 0 1.5rem 0;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 0.5rem;
}

.section-title {
    color: #ffffff;
    font-size: 18px;
    font-weight: 600;
}

.section-divider-line {
    margin: 3rem 0;
    border: none;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.create-study-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 2rem;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.create-study-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.study-stats {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    justify-content: center;
}

.stat-item {
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    padding: 1.5rem;
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    min-width: 150px;
}

.stat-number {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: #3b82f6;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    color: #ffffff;
    font-weight: 500;
}

.study-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
}

.study-manage-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(148, 163, 184, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.study-manage-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.study-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.study-category {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.study-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #10b981;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-icon {
    width: 16px;
    height: 16px;
}

.study-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 0.75rem;
    line-height: 1.4;
}

.study-description {
    color: #64748b;
    line-height: 1.5;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.study-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #64748b;
    font-size: 0.875rem;
}

.meta-icon {
    width: 16px;
    height: 16px;
    color: #3b82f6;
}

.study-actions {
    display: flex;
    gap: 0.75rem;
}

.action-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    text-decoration: none;
    border: none;
    cursor: pointer;
}

.view-btn {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
}

.view-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.edit-btn {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.edit-btn:hover {
    background: #f59e0b;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.placeholder-space {
    margin-top: 1rem;
}

/* 알림 뱃지 스타일 */
.notification-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #ef4444;
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 50px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.category-link {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

@media (max-width: 768px) {
    .study-grid {
        grid-template-columns: 1fr;
    }
    
    .study-stats {
        flex-direction: column;
        align-items: center;
    }
    
    .study-actions {
        flex-direction: column;
    }
}
</style>

<script>
function toggleDropdown() {
    const dropdown = document.getElementById('userDropdown');
    const welcomeMessage = document.querySelector('.welcome-message');
    
    dropdown.classList.toggle('show');
    welcomeMessage.classList.toggle('active');
}

function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const mainContainer = document.querySelector('.main-container');

    sidebar.classList.toggle('collapsed');
    mainContainer.classList.toggle('sidebar-collapsed');
}

function editStudy(studyId) {
    // 스터디 수정 기능 (향후 구현)
    alert(`스터디 수정 기능은 준비 중입니다. (ID: ${studyId})`);
}

// 외부 클릭시 드롭다운 닫기
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('userDropdown');
    const userInfo = document.querySelector('.user-info');
    
    if (dropdown && userInfo && !userInfo.contains(event.target)) {
        dropdown.classList.remove('show');
        document.querySelector('.welcome-message').classList.remove('active');
    }
});
</script>

</body>
</html>